<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Fila de Chamados - Payhub</title>
    <!-- CDNs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos otimizados */
        :root {
            --sp-blue: #0078d4;
            --sp-blue-dark: #106ebe;
            --sp-green: #107c10;
            --sp-yellow: #ffb900;
            --sp-red: #d13438;
            --sp-orange: #ca5010;
            --sp-gray-light: #f3f2f1;
            --sp-gray-medium: #edebe9;
            --sp-gray-dark: #323130;
            --sp-text-primary: #323130;
            --sp-text-secondary: #605e5c;
            --sp-background: #faf9f8;
            --sp-surface: #ffffff;
            --sp-purple: #9b59b6;
            --sp-cyan: #00bcd4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: var(--sp-background);
            color: var(--sp-text-primary);
            line-height: 1.5;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--sp-surface);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 24px;
            border: 1px solid var(--sp-gray-medium);
        }
        
        /* Header */
        .header {
            border-bottom: 2px solid var(--sp-blue);
            padding-bottom: 20px;
            margin-bottom: 24px;
        }
        
        .header h1 {
            color: var(--sp-blue);
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header p {
            color: var(--sp-text-secondary);
            font-size: 14px;
        }
        
        /* Painel de tempo */
        .time-panel {
            background: linear-gradient(135deg, var(--sp-blue) 0%, var(--sp-blue-dark) 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .time-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .time-text {
            display: flex;
            flex-direction: column;
        }
        
        .time-date {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .time-clock {
            font-size: 20px;
            font-weight: 600;
        }
        
        .simulation-indicator {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Grid principal */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Cards */
        .card {
            background: var(--sp-surface);
            border: 1px solid var(--sp-gray-medium);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: box-shadow 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--sp-text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--sp-gray-light);
        }
        
        /* Item de analista */
        .analyst-card {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            background-color: var(--sp-gray-light);
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        
        .analyst-card.active {
            background-color: #e6f7ff;
            border-color: var(--sp-blue);
            box-shadow: 0 2px 8px rgba(0, 120, 212, 0.2);
        }
        
        .analyst-card.next {
            background-color: #fff9e6;
            border-color: var(--sp-yellow);
        }
        
        .analyst-card.busy {
            background-color: #fef5e7;
            border-color: var(--sp-orange);
        }
        
        .analyst-card.waiting-client {
            background-color: #e6f3ff;
            border-color: var(--sp-cyan);
        }
        
        .analyst-card.offline {
            background-color: #f8f9fa;
            color: var(--sp-text-secondary);
            border: 1px dashed var(--sp-gray-medium);
        }
        
        .analyst-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .analyst-name {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analyst-level {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: var(--sp-blue);
            color: white;
            font-weight: 600;
        }
        
        .analyst-level.n1 {
            background-color: var(--sp-blue);
        }
        
        .analyst-level.n2 {
            background-color: var(--sp-purple);
        }
        
        .analyst-schedule {
            font-size: 13px;
            color: var(--sp-text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ticket-info {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 6px;
            color: var(--sp-text-primary);
            font-weight: 600;
            border-left: 3px solid var(--sp-blue);
        }
        
        .ticket-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .ticket-status.aguardando {
            background-color: var(--sp-cyan);
            color: white;
        }
        
        .ticket-status.atendendo {
            background-color: var(--sp-orange);
            color: white;
        }
        
        .ticket-number {
            color: var(--sp-blue);
            font-weight: 700;
        }
        
        .analyst-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 13px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-available {
            background-color: var(--sp-green);
        }
        
        .status-busy {
            background-color: var(--sp-orange);
        }
        
        .status-waiting {
            background-color: var(--sp-cyan);
        }
        
        .status-offline {
            background-color: var(--sp-red);
        }
        
        .ticket-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        /* Status buttons */
        .status-buttons {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        
        .status-btn {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        .status-btn.waiting {
            background-color: var(--sp-cyan);
            color: white;
        }
        
        .status-btn.resume {
            background-color: var(--sp-green);
            color: white;
        }
        
        .status-btn.finish {
            background-color: var(--sp-red);
            color: white;
        }
        
        /* Inputs */
        .input-field {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--sp-gray-medium);
            border-radius: 6px;
            font-size: 14px;
            color: var(--sp-text-primary);
            background-color: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--sp-blue);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }
        
        select.input-field {
            cursor: pointer;
        }
        
        /* Botões */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            height: 36px;
            background-color: var(--sp-blue);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn:hover {
            background-color: var(--sp-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background-color: var(--sp-green);
        }
        
        .btn-success:hover {
            background-color: #0c6c0c;
        }
        
        .btn-warning {
            background-color: var(--sp-yellow);
            color: var(--sp-text-primary);
        }
        
        .btn-warning:hover {
            background-color: #e6a700;
        }
        
        .btn-danger {
            background-color: var(--sp-red);
        }
        
        .btn-danger:hover {
            background-color: #c02a2e;
        }
        
        .btn-purple {
            background-color: var(--sp-purple);
        }
        
        .btn-purple:hover {
            background-color: #8e44ad;
        }
        
        .btn-cyan {
            background-color: var(--sp-cyan);
        }
        
        .btn-cyan:hover {
            background-color: #0097a7;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            height: 28px;
        }
        
        /* Painel de estatísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: var(--sp-surface);
            border: 1px solid var(--sp-gray-medium);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--sp-blue);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--sp-text-secondary);
        }
        
        /* Painel de controles */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* Clientes especiais */
        .special-client {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            background-color: #f0f7ff;
            border-left: 4px solid var(--sp-blue);
        }
        
        .client-info {
            display: flex;
            flex-direction: column;
        }
        
        .client-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--sp-text-primary);
        }
        
        .assigned-analyst {
            background-color: var(--sp-blue);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Modais */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--sp-surface);
            padding: 24px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--sp-gray-medium);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--sp-text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--sp-text-secondary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        
        .close-modal:hover {
            background-color: var(--sp-gray-light);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: flex-end;
        }
        
        /* Notificações */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--sp-green);
            color: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
        }
        
        .notification.warning {
            background-color: var(--sp-yellow);
            color: var(--sp-text-primary);
        }
        
        .notification.error {
            background-color: var(--sp-red);
        }
        
        .notification.info {
            background-color: var(--sp-blue);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Footer */
        .footer {
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid var(--sp-gray-medium);
            text-align: center;
            color: var(--sp-text-secondary);
            font-size: 13px;
        }
        
        .last-reset {
            margin-top: 8px;
            font-style: italic;
            color: var(--sp-text-secondary);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .analyst-card {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .ticket-controls {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 22px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .time-panel {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <h1>
                <i class="fas fa-headset"></i>
                Portal de Fila de Chamados - Payhub
            </h1>
            <p>Sistema de gerenciamento de atendimento da equipe N1/N2</p>
        </div>
        
        <!-- Painel de tempo -->
        <div class="time-panel">
            <div class="time-info">
                <i class="fas fa-clock" style="font-size: 24px;"></i>
                <div class="time-text">
                    <div class="time-date" id="currentDate">Carregando data...</div>
                    <div class="time-clock" id="currentTime">Carregando hora...</div>
                </div>
            </div>
            <div id="simulationIndicator" class="simulation-indicator" style="display: none;">
                <i class="fas fa-magic"></i>
                Horário simulado
            </div>
        </div>
        
        <!-- Grid principal -->
        <div class="main-grid">
            <!-- Fila de atendimento -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-list-ol"></i>
                    Fila de Atendimento - N1
                </div>
                <div id="queueList">
                    <!-- Lista de analistas será gerada via JavaScript -->
                </div>
            </div>
            
            <!-- Clientes especiais -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-star"></i>
                    Clientes Especiais
                </div>
                <div id="specialCases">
                    <!-- Casos especiais serão gerados via JavaScript -->
                </div>
                
                <!-- Informações -->
                <div style="margin-top: 24px; padding: 16px; background-color: var(--sp-gray-light); border-radius: 8px;">
                    <div style="font-weight: 600; color: var(--sp-text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-info-circle"></i>
                        Como funciona
                    </div>
                    <ul style="list-style-type: none; padding-left: 0; font-size: 13px; color: var(--sp-text-secondary);">
                        <li style="margin-bottom: 6px; display: flex; align-items: flex-start; gap: 8px;">
                            <i class="fas fa-check-circle" style="color: var(--sp-green); margin-top: 2px;"></i>
                            <span>Clientes especiais são direcionados automaticamente</span>
                        </li>
                        <li style="margin-bottom: 6px; display: flex; align-items: flex-start; gap: 8px;">
                            <i class="fas fa-sync-alt" style="color: var(--sp-blue); margin-top: 2px;"></i>
                            <span>Eric participa da fila normal exceto para casos TIM</span>
                        </li>
                        <li style="display: flex; align-items: flex-start; gap: 8px;">
                            <i class="fas fa-history" style="color: var(--sp-yellow); margin-top: 2px;"></i>
                            <span>Fila reinicia após 7 chamados ou no dia seguinte</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Estatísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTickets">0</div>
                <div class="stat-label">Chamados Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeAnalysts">0</div>
                <div class="stat-label">Analistas Ativos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="nextInQueue">-</div>
                <div class="stat-label">Próximo na Fila</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="specialTickets">0</div>
                <div class="stat-label">Casos Especiais</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="waitingTickets">0</div>
                <div class="stat-label">Aguardando Cliente</div>
            </div>
        </div>
        
        <!-- Painel de controles -->
        <div class="controls-grid">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-plus-circle"></i>
                    Novo Chamado
                </div>
                <div class="control-group">
                    <input type="text" id="newTicketNumber" class="input-field" placeholder="Número do chamado (ou deixe em branco para gerar automático)">
                    <select id="ticketType" class="input-field">
                        <option value="normal">Chamado Normal</option>
                        <option value="TIM">Cliente TIM (Eric)</option>
                        <option value="DPSP">Cliente DPSP (Tamiris)</option>
                        <option value="Benoit">Cliente Benoit (André)</option>
                    </select>
                    <button class="btn btn-success" id="addTicketBtn">
                        <i class="fas fa-plus"></i>
                        Adicionar Chamado
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-cogs"></i>
                    Controles da Fila
                </div>
                <div class="control-group">
                    <button class="btn" id="nextAnalystBtn">
                        <i class="fas fa-forward"></i>
                        Próximo Analista
                    </button>
                    <button class="btn btn-warning" id="resetQueueBtn">
                        <i class="fas fa-redo-alt"></i>
                        Reiniciar Fila do Dia
                    </button>
                    <button class="btn btn-danger" id="freeAllBtn">
                        <i class="fas fa-user-check"></i>
                        Liberar Todos
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-clock"></i>
                    Simulação de Horário
                </div>
                <div class="control-group">
                    <button class="btn" id="simulateTimeBtn">
                        <i class="fas fa-magic"></i>
                        Simular Horário
                    </button>
                    <button class="btn btn-warning" id="realTimeBtn" style="display: none;">
                        <i class="fas fa-clock"></i>
                        Voltar ao Horário Real
                    </button>
                    <div class="last-reset" id="lastResetInfo"></div>
                </div>
            </div>
        </div>
        
        <!-- Rodapé -->
        <div class="footer">
            <p><strong>Portal de Fila de Chamados - Equipe Payhub</strong> | Desenvolvido para uso interno</p>
            <p>Última atualização: <span id="lastUpdate">--:--:--</span></p>
            <p class="last-reset">Fila reiniciada em: <span id="lastResetDate"></span></p>
        </div>
    </div>
    
    <!-- Modal para simulação de horário -->
    <div id="timeSimulationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-clock"></i>
                    Simular Horário
                </div>
                <button class="close-modal" id="closeTimeModal">&times;</button>
            </div>
            
            <p style="margin-bottom: 20px; color: var(--sp-text-secondary); font-size: 14px;">
                Selecione um horário para simular o comportamento da fila:
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px;">
                <button class="btn time-option" data-hour="7">7:00</button>
                <button class="btn time-option" data-hour="8">8:00</button>
                <button class="btn time-option" data-hour="9">9:00</button>
                <button class="btn time-option" data-hour="10">10:00</button>
                <button class="btn time-option" data-hour="14">14:00</button>
                <button class="btn time-option" data-hour="18">18:00</button>
                <button class="btn time-option" data-hour="22">22:00</button>
                <button class="btn time-option" data-hour="23">23:00</button>
            </div>
            
            <div style="background-color: var(--sp-gray-light); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                <div style="font-weight: 600; color: var(--sp-text-primary); margin-bottom: 12px;">Horários de Expediente:</div>
                <div style="font-size: 13px; color: var(--sp-text-secondary); display: flex; flex-direction: column; gap: 6px;">
                    <div><i class="far fa-clock" style="width: 16px;"></i> 8h-17h: Eric, Jonathan</div>
                    <div><i class="far fa-clock" style="width: 16px;"></i> 9h-18h: Carolina, Cristiane, Tamiris</div>
                    <div><i class="far fa-clock" style="width: 16px;"></i> 14h-23h: Sander, Yan</div>
                    <div><i class="far fa-clock" style="width: 16px;"></i> 8h-18h: André, Felipe (N2)</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-danger" id="cancelSimulation">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button class="btn btn-success" id="applySimulation">
                    <i class="fas fa-check"></i>
                    Aplicar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURAÇÃO DOS ANALISTAS
        // ============================================
        
        const analysts = [
            { 
                id: 1, 
                name: "Eric", 
                level: "N1", 
                startTime: 8, 
                endTime: 17, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null, // 'atendendo', 'aguardando-cliente', null
                specialClient: "TIM",
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 2, 
                name: "Carolina", 
                level: "N1", 
                startTime: 9, 
                endTime: 18, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 3, 
                name: "Tamiris", 
                level: "N1", 
                startTime: 9, 
                endTime: 18, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: "DPSP",
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 4, 
                name: "Cristiane", 
                level: "N1", 
                startTime: 9, 
                endTime: 18, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 5, 
                name: "Jonathan", 
                level: "N1", 
                startTime: 8, 
                endTime: 17, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 6, 
                name: "Sander", 
                level: "N1", 
                startTime: 14, 
                endTime: 23, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 7, 
                name: "Yan", 
                level: "N1", 
                startTime: 14, 
                endTime: 23, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: true,
                ticketsHandled: 0
            },
            { 
                id: 8, 
                name: "André", 
                level: "N2", 
                startTime: 8, 
                endTime: 18, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: "Benoit",
                inQueue: false,
                ticketsHandled: 0
            },
            { 
                id: 9, 
                name: "Felipe", 
                level: "N2", 
                startTime: 8, 
                endTime: 18, 
                isAvailable: false, 
                isBusy: false,
                currentTicket: null,
                ticketStatus: null,
                specialClient: null,
                inQueue: false,
                ticketsHandled: 0
            }
        ];

        // Clientes especiais
        const specialClients = [
            { client: "Benoit", analyst: "André", level: "N2" },
            { client: "TIM", analyst: "Eric", level: "N1" },
            { client: "DPSP", analyst: "Tamiris", level: "N1" }
        ];

        // Estado da aplicação
        let state = {
            currentAnalystIndex: 0,
            ticketsToday: 0,
            specialTicketsToday: 0,
            waitingTicketsToday: 0,
            lastReset: new Date().toLocaleDateString('pt-BR'),
            queueOrder: [],
            lastUpdate: new Date().toLocaleTimeString('pt-BR'),
            simulatedTime: null,
            nextTicketNumber: 1000,
            dailyResetDone: false
        };

        // ============================================
        // INICIALIZAÇÃO DA APLICAÇÃO
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            
            // Atualizar a cada minuto
            setInterval(updateApp, 60000);
        });

        function initializeApp() {
            updateCurrentTime();
            updateAnalystAvailability();
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            updateLastUpdateTime();
            
            // Carregar estado salvo
            loadState();
            
            // Verificar reset diário
            checkDailyReset();
        }

        function setupEventListeners() {
            // Botões principais
            document.getElementById('addTicketBtn').addEventListener('click', handleNewTicket);
            document.getElementById('nextAnalystBtn').addEventListener('click', nextAnalyst);
            document.getElementById('resetQueueBtn').addEventListener('click', resetQueue);
            document.getElementById('freeAllBtn').addEventListener('click', freeAllAnalysts);
            document.getElementById('simulateTimeBtn').addEventListener('click', openTimeSimulationModal);
            document.getElementById('realTimeBtn').addEventListener('click', returnToRealTime);
            
            // Modal de simulação
            document.getElementById('closeTimeModal').addEventListener('click', closeTimeSimulationModal);
            document.getElementById('cancelSimulation').addEventListener('click', closeTimeSimulationModal);
            document.getElementById('applySimulation').addEventListener('click', applyTimeSimulation);
            
            // Opções de horário no modal
            document.querySelectorAll('.time-option').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.time-option').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Permitir Enter no campo de número do chamado
            document.getElementById('newTicketNumber').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleNewTicket();
                }
            });
        }

        // ============================================
        // FUNÇÕES PRINCIPAIS
        // ============================================
        
        function updateCurrentTime() {
            const now = state.simulatedTime ? new Date(state.simulatedTime) : new Date();
            
            // Formatar data
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('pt-BR', dateOptions);
            
            // Formatar hora
            const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            // Atualizar elementos
            document.getElementById('currentDate').textContent = dateString;
            document.getElementById('currentTime').textContent = timeString;
            
            // Mostrar/ocultar indicador de simulação
            const simulationIndicator = document.getElementById('simulationIndicator');
            const realTimeBtn = document.getElementById('realTimeBtn');
            
            if (state.simulatedTime) {
                simulationIndicator.style.display = 'inline-flex';
                realTimeBtn.style.display = 'block';
            } else {
                simulationIndicator.style.display = 'none';
                realTimeBtn.style.display = 'none';
            }
            
            updateAnalystAvailability();
        }

        function updateAnalystAvailability() {
            const now = state.simulatedTime ? new Date(state.simulatedTime) : new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTime = currentHour + currentMinutes / 100;
            
            analysts.forEach(analyst => {
                const startTime = analyst.startTime;
                const endTime = analyst.endTime;
                
                // Verificar se está no horário de trabalho
                analyst.isAvailable = (currentTime >= startTime && currentTime < endTime);
                
                // Analistas aguardando cliente estão disponíveis para nova chamada
                if (analyst.ticketStatus === 'aguardando-cliente') {
                    analyst.isBusy = false;
                } else if (analyst.ticketStatus === 'atendendo' || analyst.currentTicket) {
                    analyst.isBusy = true;
                }
                
                // Ajustes para casos especiais
                if (analyst.name === "Eric" && analyst.currentTicket === "TIM") {
                    analyst.isBusy = true;
                    analyst.isAvailable = false;
                }
                
                if (analyst.name === "Tamiris" && analyst.currentTicket === "DPSP") {
                    analyst.isBusy = true;
                    analyst.isAvailable = false;
                }
                
                if (analyst.name === "André" && analyst.currentTicket === "Benoit") {
                    analyst.isBusy = true;
                    analyst.isAvailable = false;
                }
            });
            
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            saveState();
        }

        function updateQueueOrder() {
            // Filtrar apenas analistas N1 disponíveis (não ocupados)
            const availableAnalysts = analysts.filter(a => 
                a.level === "N1" && 
                a.isAvailable && 
                !a.isBusy && // Não está ocupado com atendimento
                a.inQueue
            );
            
            if (availableAnalysts.length === 0) {
                state.queueOrder = [];
                state.currentAnalystIndex = 0;
                return;
            }
            
            // Se a fila está vazia ou precisa ser reiniciada
            if (state.queueOrder.length === 0 || state.currentAnalystIndex >= availableAnalysts.length) {
                // Ordenar por menos chamados atendidos
                state.queueOrder = [...availableAnalysts].sort((a, b) => {
                    if (a.ticketsHandled !== b.ticketsHandled) {
                        return a.ticketsHandled - b.ticketsHandled;
                    }
                    return a.id - b.id;
                });
                state.currentAnalystIndex = 0;
            } else {
                // Atualizar fila mantendo ordem
                state.queueOrder = state.queueOrder
                    .filter(a => availableAnalysts.some(av => av.id === a.id))
                    .map(a => {
                        const updated = availableAnalysts.find(av => av.id === a.id);
                        return updated || a;
                    });
                
                // Ajustar índice se necessário
                if (state.currentAnalystIndex >= state.queueOrder.length) {
                    state.currentAnalystIndex = 0;
                }
            }
        }

        function updateQueueDisplay() {
            const queueList = document.getElementById('queueList');
            const queueAnalysts = analysts.filter(a => a.level === "N1" && a.inQueue);
            
            if (queueAnalysts.length === 0) {
                queueList.innerHTML = `
                    <div class="analyst-card offline">
                        <div class="analyst-info">
                            <div class="analyst-name">Nenhum analista configurado</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let queueHTML = '';
            
            // Analista atual
            if (state.queueOrder.length > 0 && state.currentAnalystIndex < state.queueOrder.length) {
                const currentAnalyst = state.queueOrder[state.currentAnalystIndex];
                const statusClass = currentAnalyst.ticketStatus === 'aguardando-cliente' ? 'waiting-client' : 'active';
                queueHTML += createAnalystCardHTML(currentAnalyst, statusClass);
            }
            
            // Próximos analistas
            for (let i = 1; i <= 3; i++) {
                const nextIndex = (state.currentAnalystIndex + i) % state.queueOrder.length;
                if (nextIndex < state.queueOrder.length && i < state.queueOrder.length) {
                    const nextAnalyst = state.queueOrder[nextIndex];
                    const statusClass = i === 1 ? 'next' : '';
                    queueHTML += createAnalystCardHTML(nextAnalyst, statusClass);
                }
            }
            
            // Outros analistas
            const otherAnalysts = analysts.filter(a => 
                a.level === "N1" && 
                a.inQueue && 
                (a.isBusy || a.currentTicket || !a.isAvailable)
            );
            
            const displayedIds = state.queueOrder.slice(0, 4).map(a => a.id);
            const toDisplay = otherAnalysts.filter(a => !displayedIds.includes(a.id));
            
            if (toDisplay.length > 0) {
                queueHTML += `<div style="margin-top: 20px; color: var(--sp-text-secondary); font-size: 14px; font-weight: 600;">
                    <i class="fas fa-user-clock"></i> Outros Analistas
                </div>`;
                
                toDisplay.forEach(analyst => {
                    let statusClass = 'offline';
                    if (analyst.ticketStatus === 'aguardando-cliente') {
                        statusClass = 'waiting-client';
                    } else if (analyst.isBusy) {
                        statusClass = 'busy';
                    }
                    queueHTML += createAnalystCardHTML(analyst, statusClass);
                });
            }
            
            queueList.innerHTML = queueHTML;
            
            // Adicionar eventos aos botões
            attachAnalystCardEvents();
        }

        function createAnalystCardHTML(analyst, status) {
            let statusText = '';
            let statusClass = status;
            
            if (status === 'active') {
                statusText = 'ANALISTA ATUAL';
            } else if (status === 'next') {
                statusText = 'PRÓXIMO NA FILA';
            } else if (analyst.ticketStatus === 'aguardando-cliente') {
                statusText = 'AGUARDANDO CLIENTE';
                statusClass = 'waiting-client';
            } else if (analyst.ticketStatus === 'atendendo' || analyst.isBusy) {
                statusText = 'EM ATENDIMENTO';
            } else if (!analyst.isAvailable) {
                statusText = 'FORA DO HORÁRIO';
            } else {
                statusText = 'DISPONÍVEL';
            }
            
            let ticketInfo = '';
            if (analyst.currentTicket) {
                const clientName = getClientNameFromTicket(analyst.currentTicket);
                const statusBadge = analyst.ticketStatus === 'aguardando-cliente' ? 
                    '<span class="ticket-status aguardando">AGUARDANDO</span>' : 
                    '<span class="ticket-status atendendo">ATENDENDO</span>';
                
                ticketInfo = `
                    <div class="ticket-info">
                        <i class="fas fa-ticket-alt"></i> 
                        <span class="ticket-number">${analyst.currentTicket}</span>
                        ${statusBadge}
                        ${clientName ? `<div style="font-size: 12px; color: var(--sp-text-secondary); margin-top: 4px;">
                            <i class="fas fa-user"></i> ${clientName}
                        </div>` : ''}
                    </div>
                `;
            }
            
            let ticketControls = '';
            if (analyst.currentTicket) {
                ticketControls = `
                    <div class="status-buttons">
                        ${analyst.ticketStatus === 'aguardando-cliente' ? `
                            <button class="status-btn resume resume-ticket-btn" data-analyst-id="${analyst.id}">
                                <i class="fas fa-play"></i> Retomar
                            </button>
                        ` : `
                            <button class="status-btn waiting waiting-client-btn" data-analyst-id="${analyst.id}">
                                <i class="fas fa-clock"></i> Aguardar
                            </button>
                        `}
                        <button class="status-btn finish finish-ticket-btn" data-analyst-id="${analyst.id}">
                            <i class="fas fa-check"></i> Finalizar
                        </button>
                    </div>
                `;
            } else {
                ticketControls = `
                    <input type="text" class="input-field assign-ticket-input" 
                           placeholder="Nº Chamado" 
                           data-analyst-id="${analyst.id}"
                           style="font-size: 12px; padding: 6px 10px;">
                    <button class="btn btn-small assign-ticket-btn" data-analyst-id="${analyst.id}">
                        <i class="fas fa-paperclip"></i> Atribuir
                    </button>
                `;
            }
            
            return `
                <div class="analyst-card ${statusClass}" data-analyst-id="${analyst.id}">
                    <div class="analyst-info">
                        <div class="analyst-name">
                            ${analyst.name}
                            <span class="analyst-level ${analyst.level.toLowerCase()}">${analyst.level}</span>
                        </div>
                        <div class="analyst-schedule">
                            <i class="far fa-clock"></i> 
                            ${analyst.startTime}h - ${analyst.endTime}h
                        </div>
                        ${ticketInfo}
                        <div style="font-size: 12px; color: var(--sp-text-secondary); margin-top: 6px;">
                            <i class="fas fa-tasks"></i> Chamados hoje: ${analyst.ticketsHandled}
                        </div>
                    </div>
                    
                    <div class="analyst-status">
                        <div class="status-indicator">
                            <span class="status-dot ${getStatusDotClass(analyst)}"></span>
                            <span>${statusText}</span>
                        </div>
                        ${analyst.specialClient ? `
                            <div style="font-size: 11px; color: var(--sp-purple); margin-top: 4px;">
                                <i class="fas fa-star"></i> ${analyst.specialClient}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="ticket-controls">
                        ${ticketControls}
                    </div>
                </div>
            `;
        }

        function getStatusDotClass(analyst) {
            if (analyst.ticketStatus === 'aguardando-cliente') {
                return 'status-waiting';
            } else if (analyst.isBusy || analyst.currentTicket) {
                return 'status-busy';
            } else if (analyst.isAvailable) {
                return 'status-available';
            } else {
                return 'status-offline';
            }
        }

        function getClientNameFromTicket(ticket) {
            const specialClient = specialClients.find(c => 
                c.analyst === "Eric" && ticket === "TIM" ||
                c.analyst === "Tamiris" && ticket === "DPSP" ||
                c.analyst === "André" && ticket === "Benoit"
            );
            return specialClient ? specialClient.client : null;
        }

        function attachAnalystCardEvents() {
            // Botões de atribuir ticket
            document.querySelectorAll('.assign-ticket-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const analystId = parseInt(this.getAttribute('data-analyst-id'));
                    const input = document.querySelector(`.assign-ticket-input[data-analyst-id="${analystId}"]`);
                    const ticketNumber = input.value.trim();
                    
                    if (ticketNumber) {
                        assignTicketToAnalyst(analystId, ticketNumber, 'normal', 'atendendo');
                        input.value = '';
                    } else {
                        showNotification('Digite um número de chamado', 'warning');
                    }
                });
            });
            
            // Botões de aguardar cliente
            document.querySelectorAll('.waiting-client-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const analystId = parseInt(this.getAttribute('data-analyst-id'));
                    setTicketWaiting(analystId);
                });
            });
            
            // Botões de retomar atendimento
            document.querySelectorAll('.resume-ticket-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const analystId = parseInt(this.getAttribute('data-analyst-id'));
                    resumeTicket(analystId);
                });
            });
            
            // Botões de finalizar ticket
            document.querySelectorAll('.finish-ticket-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const analystId = parseInt(this.getAttribute('data-analyst-id'));
                    finishTicket(analystId);
                });
            });
        }

        function updateSpecialCasesDisplay() {
            const specialCasesDiv = document.getElementById('specialCases');
            let specialCasesHTML = '';
            
            specialClients.forEach(special => {
                const analyst = analysts.find(a => a.name === special.analyst);
                const isAvailable = analyst ? analyst.isAvailable && !analyst.isBusy : false;
                const isBusy = analyst ? (analyst.isBusy && analyst.ticketStatus !== 'aguardando-cliente') || analyst.currentTicket === special.client : false;
                const isWaiting = analyst ? analyst.ticketStatus === 'aguardando-cliente' : false;
                
                specialCasesHTML += `
                    <div class="special-client">
                        <div class="client-info">
                            <div class="client-name">Cliente ${special.client}</div>
                            <div style="font-size: 13px; color: var(--sp-text-secondary); margin-top: 4px;">
                                Atendimento dedicado
                            </div>
                        </div>
                        <div>
                            <div class="assigned-analyst">${special.analyst} (${special.level})</div>
                            <div style="margin-top: 12px; text-align: center;">
                                <div class="status-indicator">
                                    <span class="status-dot ${isWaiting ? 'status-waiting' : isBusy ? 'status-busy' : isAvailable ? 'status-available' : 'status-offline'}"></span>
                                    <span style="font-size: 12px;">
                                        ${isWaiting ? 'AGUARDANDO' : isBusy ? 'ATENDENDO' : isAvailable ? 'DISPONÍVEL' : 'INDISPONÍVEL'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            specialCasesDiv.innerHTML = specialCasesHTML;
        }

        function updateStatistics() {
            // Chamados hoje
            document.getElementById('totalTickets').textContent = state.ticketsToday;
            
            // Analistas ativos
            const activeAnalysts = analysts.filter(a => a.isAvailable && !a.isBusy).length;
            document.getElementById('activeAnalysts').textContent = activeAnalysts;
            
            // Próximo na fila
            let nextInQueue = '-';
            if (state.queueOrder.length > 0) {
                const nextIndex = (state.currentAnalystIndex + 1) % state.queueOrder.length;
                if (nextIndex < state.queueOrder.length) {
                    nextInQueue = state.queueOrder[nextIndex].name;
                }
            }
            document.getElementById('nextInQueue').textContent = nextInQueue;
            
            // Chamados especiais
            document.getElementById('specialTickets').textContent = state.specialTicketsToday;
            
            // Chamados aguardando cliente
            const waitingTickets = analysts.filter(a => a.ticketStatus === 'aguardando-cliente').length;
            document.getElementById('waitingTickets').textContent = waitingTickets;
            state.waitingTicketsToday = waitingTickets;
            
            // Último reset
            document.getElementById('lastResetDate').textContent = state.lastReset;
            document.getElementById('lastResetInfo').textContent = `Fila reiniciada em: ${state.lastReset}`;
        }

        function handleNewTicket() {
            const ticketNumberInput = document.getElementById('newTicketNumber');
            const ticketTypeSelect = document.getElementById('ticketType');
            
            let ticketNumber = ticketNumberInput.value.trim();
            const ticketType = ticketTypeSelect.value;
            
            // Gerar número automático se não informado
            if (!ticketNumber) {
                ticketNumber = `CH-${state.nextTicketNumber}`;
                state.nextTicketNumber++;
            }
            
            // Processar chamado
            if (ticketType !== 'normal') {
                handleSpecialTicket(ticketNumber, ticketType);
            } else {
                handleNormalTicket(ticketNumber);
            }
            
            // Limpar campo
            ticketNumberInput.value = '';
            saveState();
        }

        function handleNormalTicket(ticketNumber) {
            if (state.queueOrder.length === 0) {
                showNotification('Nenhum analista disponível na fila!', 'warning');
                return;
            }
            
            const currentAnalyst = state.queueOrder[state.currentAnalystIndex];
            
            if (!currentAnalyst.isAvailable || (currentAnalyst.isBusy && currentAnalyst.ticketStatus !== 'aguardando-cliente')) {
                showNotification(`${currentAnalyst.name} não está disponível. Indo para o próximo...`, 'warning');
                nextAnalyst();
                
                const newCurrentAnalyst = state.queueOrder[state.currentAnalystIndex];
                if (newCurrentAnalyst && newCurrentAnalyst.isAvailable && !newCurrentAnalyst.isBusy) {
                    assignTicketToAnalyst(newCurrentAnalyst.id, ticketNumber, 'normal', 'atendendo');
                } else {
                    showNotification('Nenhum analista disponível!', 'error');
                }
                return;
            }
            
            assignTicketToAnalyst(currentAnalyst.id, ticketNumber, 'normal', 'atendendo');
            nextAnalyst();
            state.ticketsToday++;
            
            showNotification(`Chamado ${ticketNumber} atribuído a ${currentAnalyst.name}`, 'success');
        }

        function handleSpecialTicket(ticketNumber, ticketType) {
            const specialClient = specialClients.find(c => 
                ticketType === 'TIM' ? c.client === 'TIM' :
                ticketType === 'DPSP' ? c.client === 'DPSP' :
                ticketType === 'Benoit' ? c.client === 'Benoit' : false
            );
            
            if (!specialClient) {
                showNotification(`Cliente especial não encontrado!`, 'error');
                return;
            }
            
            const analyst = analysts.find(a => a.name === specialClient.analyst);
            
            if (!analyst) {
                showNotification(`Analista ${specialClient.analyst} não encontrado!`, 'error');
                return;
            }
            
            if (!analyst.isAvailable || (analyst.isBusy && analyst.ticketStatus !== 'aguardando-cliente')) {
                showNotification(`${analyst.name} não está disponível!`, 'warning');
                return;
            }
            
            assignTicketToAnalyst(analyst.id, ticketNumber, ticketType, 'atendendo');
            state.ticketsToday++;
            state.specialTicketsToday++;
            
            showNotification(`Chamado especial ${ticketNumber} atribuído a ${analyst.name}`, 'success');
        }

        function assignTicketToAnalyst(analystId, ticketNumber, ticketType, ticketStatus = 'atendendo') {
            const analyst = analysts.find(a => a.id === analystId);
            
            if (!analyst) return;
            
            analyst.isBusy = ticketStatus === 'atendendo';
            analyst.currentTicket = ticketNumber;
            analyst.ticketStatus = ticketStatus;
            
            // Tratamento para clientes especiais
            if (ticketType !== 'normal') {
                const clientName = getClientNameFromTicket(ticketType);
                if (analyst.specialClient === clientName) {
                    analyst.currentTicket = clientName;
                }
            }
            
            analyst.ticketsHandled++;
            
            // Remover da fila se for caso especial
            if (analyst.name === "Eric" && ticketType === "TIM") {
                analyst.inQueue = false;
            }
            
            if (analyst.name === "Tamiris" && ticketType === "DPSP") {
                analyst.inQueue = false;
            }
            
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
        }

        function setTicketWaiting(analystId) {
            const analyst = analysts.find(a => a.id === analystId);
            
            if (!analyst) return;
            
            // Colocar o chamado em espera (aguardando cliente)
            analyst.ticketStatus = 'aguardando-cliente';
            analyst.isBusy = false; // Fica disponível para nova chamada
            
            // Retornar à fila se for analista N1
            if (analyst.level === "N1" && analyst.inQueue) {
                updateQueueOrder();
            }
            
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            
            showNotification(`${analyst.name} está aguardando retorno do cliente`, 'info');
            saveState();
        }

        function resumeTicket(analystId) {
            const analyst = analysts.find(a => a.id === analystId);
            
            if (!analyst) return;
            
            // Retomar o atendimento do chamado em espera
            analyst.ticketStatus = 'atendendo';
            analyst.isBusy = true;
            
            // Se estiver na fila, remover temporariamente
            if (analyst.level === "N1" && analyst.inQueue) {
                updateQueueOrder();
            }
            
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            
            showNotification(`${analyst.name} retomou o atendimento`, 'success');
            saveState();
        }

        function finishTicket(analystId) {
            const analyst = analysts.find(a => a.id === analystId);
            
            if (!analyst) return;
            
            const ticketNumber = analyst.currentTicket;
            
            // Finalizar o chamado
            analyst.isBusy = false;
            analyst.currentTicket = null;
            analyst.ticketStatus = null;
            
            // Reintegrar à fila se for Eric ou Tamiris (casos especiais)
            if (analyst.name === "Eric" || analyst.name === "Tamiris") {
                analyst.inQueue = true;
            }
            
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            
            showNotification(`Chamado ${ticketNumber} finalizado por ${analyst.name}`, 'success');
            saveState();
        }

        function freeAllAnalysts() {
            let freedCount = 0;
            
            analysts.forEach(analyst => {
                if (analyst.isBusy || analyst.currentTicket) {
                    analyst.isBusy = false;
                    analyst.currentTicket = null;
                    analyst.ticketStatus = null;
                    analyst.inQueue = analyst.level === "N1";
                    freedCount++;
                }
            });
            
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            
            showNotification(`${freedCount} analistas liberados`, 'success');
            saveState();
        }

        function nextAnalyst() {
            if (state.queueOrder.length === 0) {
                showNotification('Não há analistas na fila!', 'warning');
                return;
            }
            
            state.currentAnalystIndex = (state.currentAnalystIndex + 1) % state.queueOrder.length;
            updateQueueDisplay();
            updateStatistics();
            
            const currentAnalyst = state.queueOrder[state.currentAnalystIndex];
            showNotification(`Próximo analista: ${currentAnalyst.name}`, 'info');
            
            saveState();
        }

        function resetQueue() {
            if (!confirm('Tem certeza que deseja reiniciar a fila do dia?')) {
                return;
            }
            
            state.currentAnalystIndex = 0;
            state.queueOrder = [];
            state.lastReset = new Date().toLocaleDateString('pt-BR');
            state.dailyResetDone = false;
            
            analysts.forEach(analyst => {
                analyst.ticketsHandled = 0;
                analyst.isBusy = false;
                analyst.currentTicket = null;
                analyst.ticketStatus = null;
                analyst.inQueue = analyst.level === "N1";
            });
            
            state.ticketsToday = 0;
            state.specialTicketsToday = 0;
            state.waitingTicketsToday = 0;
            state.nextTicketNumber = 1000;
            
            updateQueueOrder();
            updateQueueDisplay();
            updateSpecialCasesDisplay();
            updateStatistics();
            
            showNotification('Fila reiniciada para o novo dia!', 'success');
            saveState();
        }

        function checkDailyReset() {
            const now = new Date();
            const today = now.toLocaleDateString('pt-BR');
            
            if (today !== state.lastReset && !state.dailyResetDone) {
                resetQueue();
                state.dailyResetDone = true;
            }
        }

        // ============================================
        // FUNÇÕES DE SIMULAÇÃO DE HORÁRIO
        // ============================================
        
        function openTimeSimulationModal() {
            document.getElementById('timeSimulationModal').style.display = 'flex';
        }

        function closeTimeSimulationModal() {
            document.getElementById('timeSimulationModal').style.display = 'none';
        }

        function applyTimeSimulation() {
            const selectedButton = document.querySelector('.time-option.active');
            
            if (!selectedButton) {
                showNotification('Selecione um horário para simular', 'warning');
                return;
            }
            
            const hour = parseInt(selectedButton.getAttribute('data-hour'));
            const simulatedDate = new Date();
            simulatedDate.setHours(hour, 0, 0, 0);
            state.simulatedTime = simulatedDate;
            
            closeTimeSimulationModal();
            updateCurrentTime();
            
            showNotification(`Horário simulado: ${hour}:00`, 'success');
        }

        function returnToRealTime() {
            state.simulatedTime = null;
            updateCurrentTime();
            showNotification('Voltando ao horário real', 'info');
        }

        // ============================================
        // FUNÇÕES AUXILIARES
        // ============================================
        
        function updateApp() {
            updateCurrentTime();
            updateLastUpdateTime();
            checkDailyReset();
        }

        function updateLastUpdateTime() {
            state.lastUpdate = new Date().toLocaleTimeString('pt-BR');
            document.getElementById('lastUpdate').textContent = state.lastUpdate;
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        function saveState() {
            try {
                const stateToSave = {
                    ...state,
                    simulatedTime: state.simulatedTime ? state.simulatedTime.getTime() : null,
                    analysts: analysts.map(a => ({
                        id: a.id,
                        ticketsHandled: a.ticketsHandled,
                        isBusy: a.isBusy,
                        currentTicket: a.currentTicket,
                        ticketStatus: a.ticketStatus,
                        inQueue: a.inQueue
                    }))
                };
                
                localStorage.setItem('queuePortalState', JSON.stringify(stateToSave));
            } catch (e) {
                console.error('Erro ao salvar estado:', e);
            }
        }

        function loadState() {
            try {
                const savedState = localStorage.getItem('queuePortalState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    
                    state.ticketsToday = parsedState.ticketsToday || 0;
                    state.specialTicketsToday = parsedState.specialTicketsToday || 0;
                    state.waitingTicketsToday = parsedState.waitingTicketsToday || 0;
                    state.lastReset = parsedState.lastReset || new Date().toLocaleDateString('pt-BR');
                    state.currentAnalystIndex = parsedState.currentAnalystIndex || 0;
                    state.nextTicketNumber = parsedState.nextTicketNumber || 1000;
                    state.dailyResetDone = parsedState.dailyResetDone || false;
                    
                    if (parsedState.simulatedTime) {
                        state.simulatedTime = new Date(parsedState.simulatedTime);
                    }
                    
                    if (parsedState.analysts) {
                        parsedState.analysts.forEach(savedAnalyst => {
                            const analyst = analysts.find(a => a.id === savedAnalyst.id);
                            if (analyst) {
                                analyst.ticketsHandled = savedAnalyst.ticketsHandled || 0;
                                analyst.isBusy = savedAnalyst.isBusy || false;
                                analyst.currentTicket = savedAnalyst.currentTicket || null;
                                analyst.ticketStatus = savedAnalyst.ticketStatus || null;
                                analyst.inQueue = savedAnalyst.inQueue !== undefined ? savedAnalyst.inQueue : true;
                            }
                        });
                    }
                    
                    updateQueueOrder();
                    updateQueueDisplay();
                    updateSpecialCasesDisplay();
                    updateStatistics();
                    
                    showNotification('Estado anterior restaurado', 'info');
                }
            } catch (e) {
                console.error('Erro ao carregar estado:', e);
            }
        }
    </script>
</body>
</html>