<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Fila de Chamados - Payhub</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
    
    <style>
        .firebase-status {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 10px;
            font-weight: 500;
        }
        .firebase-status.connected {
            background: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #C8E6C9;
        }
        .firebase-status.disconnected {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid #FFCDD2;
        }
        .last-saved {
            font-size: 11px;
            color: #666;
            margin-left: 10px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loading-spinner-large {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Overlay de carregamento -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner-large"></div>
        <div style="font-size: 14px; color: #333; margin-top: 10px;">Inicializando sistema...</div>
        <div id="loadingStatus" style="font-size: 12px; color: #666; margin-top: 5px;">Conectando ao Firebase</div>
    </div>

    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-headset"></i>
                    Portal de Fila de Chamados - Payhub
                    <span id="versionBadge" class="version-badge">v3.5.0</span>
                </h1>
                <p>Controle de atendimentos com persistência completa em Firebase</p>
            </div>
            <div class="header-right">
                <div id="firebaseStatus" class="firebase-status">
                    <i class="fas fa-circle"></i>
                    <span>Conectando...</span>
                </div>
                <div id="lastSaved" class="last-saved" style="display: none;">
                    <i class="far fa-clock"></i>
                    <span>Salvo: --:--:--</span>
                </div>
            </div>
        </div>
        
        <!-- Menu de navegação -->
        <div class="nav-menu">
            <a href="index.html" class="nav-link active">
                <i class="fas fa-home"></i>
                Painel Principal
            </a>
            <a href="analyst-view.html" class="nav-link">
                <i class="fas fa-eye"></i>
                Visualização
            </a>
            <a href="admin.html" class="nav-link">
                <i class="fas fa-cogs"></i>
                Administração
            </a>
        </div>
        
        <!-- Painel de tempo -->
        <div class="time-panel">
            <div class="time-info">
                <i class="fas fa-clock"></i>
                <div class="time-text">
                    <div class="time-date" id="currentDate">Carregando data...</div>
                    <div class="time-clock" id="currentTime">Carregando hora...</div>
                </div>
            </div>
            <div id="simulationIndicator" class="simulation-indicator" style="display: none;">
                <i class="fas fa-magic"></i>
                Horário simulado
            </div>
        </div>
        
        <!-- COLUNAS DE STATUS DOS ANALISTAS -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-columns"></i>
                Status dos Analistas
                <span id="analystCount" class="counter-badge">9 analistas</span>
            </div>
            <div id="analystStatusColumns">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>Carregando status dos analistas...</span>
                </div>
            </div>
        </div>
        
        <!-- Clientes Especiais -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-star"></i>
                Clientes Especiais
            </div>
            <div id="specialCases">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>Carregando clientes especiais...</span>
                </div>
            </div>
        </div>
        
        <!-- Estatísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTickets">0</div>
                <div class="stat-label">Chamados Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="availableAnalystsStat">0</div>
                <div class="stat-label">Analistas Disponíveis</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="nextInQueue">-</div>
                <div class="stat-label">Próximo na Fila</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="specialTickets">0</div>
                <div class="stat-label">Casos Especiais</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="waitingTickets">0</div>
                <div class="stat-label">Aguardando Cliente</div>
            </div>
        </div>
        
        <!-- Painel de controles -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-plus-circle"></i>
                Novo Chamado - Clientes Especiais
            </div>
            <div class="control-group">
                <input type="text" id="newTicketNumber" class="input-field" 
                       placeholder="Número do chamado para cliente especial"
                       autocomplete="off" autofocus>
                <select id="ticketType" class="input-field">
                    <option value="TIM">Cliente TIM (Eric)</option>
                    <option value="DPSP">Cliente DPSP (Felipe)</option>
                    <option value="Benoit">Cliente Benoit (André)</option>
                </select>
                <button class="btn btn-success" id="addTicketBtn">
                    <i class="fas fa-plus"></i>
                    Adicionar Chamado Especial
                </button>
            </div>
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <strong>Informação:</strong> Use os inputs nos cards dos analistas disponíveis para atribuição rápida de chamados normais. Para clientes especiais, use este painel.
            </div>
        </div>
        
        <!-- Controles da Fila -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-cogs"></i>
                Controles da Fila
            </div>
            <div class="control-group">
                <button class="btn" id="nextAnalystBtn">
                    <i class="fas fa-forward"></i>
                    Avançar Fila
                </button>
                <button class="btn btn-warning" id="resetQueueBtn">
                    <i class="fas fa-redo-alt"></i>
                    Reiniciar Dia
                </button>
                <button class="btn btn-danger" id="freeAllBtn">
                    <i class="fas fa-user-check"></i>
                    Liberar Todos
                </button>
                <button class="btn" id="simulateTimeBtn">
                    <i class="fas fa-magic"></i>
                    Simular Horário
                </button>
                <button class="btn btn-cyan" id="realTimeBtn" style="display: none;">
                    <i class="fas fa-clock"></i>
                    Voltar ao Horário Real
                </button>
                <button class="btn" id="generateReportBtn">
                    <i class="fas fa-file-csv"></i>
                    Gerar Relatório
                </button>
                <button class="btn btn-test" id="testFirebaseBtn">
                    <i class="fas fa-vial"></i>
                    Testar Firebase
                </button>
            </div>
        </div>
        
        <!-- Rodapé -->
        <div class="footer">
            <p><strong>Portal de Fila de Chamados - Equipe Payhub v3.5.0</strong> | Sistema com persistência completa Firebase</p>
            <p>Última atualização: <span id="lastUpdate">--:--:--</span> | Sessão: <span id="sessionId">---</span></p>
            <p class="last-reset">Fila reiniciada em: <span id="lastResetDate"></span></p>
        </div>
    </div>
    
    <!-- Modal de Simulação de Horário -->
    <div id="timeSimulationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-magic"></i>
                    Simular Horário
                </div>
                <button class="close-modal" id="closeTimeModal">&times;</button>
            </div>
            <div class="modal-description">
                <p>Selecione um horário para simular a disponibilidade dos analistas:</p>
            </div>
            <div class="time-options-grid">
                <button class="time-option" data-hour="8">08:00</button>
                <button class="time-option" data-hour="9">09:00</button>
                <button class="time-option" data-hour="10">10:00</button>
                <button class="time-option" data-hour="11">11:00</button>
                <button class="time-option" data-hour="12">12:00</button>
                <button class="time-option" data-hour="13">13:00</button>
                <button class="time-option" data-hour="14">14:00</button>
                <button class="time-option" data-hour="15">15:00</button>
                <button class="time-option" data-hour="16">16:00</button>
                <button class="time-option" data-hour="17">17:00</button>
                <button class="time-option" data-hour="18">18:00</button>
                <button class="time-option" data-hour="19">19:00</button>
                <button class="time-option" data-hour="20">20:00</button>
                <button class="time-option" data-hour="21">21:00</button>
                <button class="time-option" data-hour="22">22:00</button>
                <button class="time-option" data-hour="23">23:00</button>
            </div>
            <div class="modal-actions">
                <button class="btn" id="cancelSimulation">Cancelar</button>
                <button class="btn btn-success" id="applySimulation">Aplicar Simulação</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Relatórios -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-csv"></i>
                    Gerar Relatório
                </div>
                <button class="close-modal" id="closeReportModal">&times;</button>
            </div>
            <div class="modal-description">
                <p>Selecione o período para gerar o relatório de chamados:</p>
            </div>
            <div class="modal-controls">
                <div class="form-group">
                    <label for="startDate">
                        <i class="far fa-calendar-alt"></i>
                        Data Inicial
                    </label>
                    <input type="date" id="startDate" class="input-field">
                </div>
                <div class="form-group">
                    <label for="endDate">
                        <i class="far fa-calendar-alt"></i>
                        Data Final
                    </label>
                    <input type="date" id="endDate" class="input-field">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="includeAllTickets">
                    <label for="includeAllTickets">Incluir todos os chamados (não apenas os especiais)</label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" id="cancelReport">Cancelar</button>
                <button class="btn btn-success" id="generateCSV">Gerar CSV</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-app.js"></script>
    <script src="app.js"></script>
    
    <script>
    // Esconder overlay quando tudo estiver carregado
    document.addEventListener('DOMContentLoaded', function() {
        // Verificar se o app.js foi carregado corretamente
        const checkAppLoaded = setInterval(() => {
            if (typeof window.appController !== 'undefined') {
                clearInterval(checkAppLoaded);
                // Dar tempo extra para a interface carregar
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 1000);
            }
        }, 500);
        
        // Timeout de segurança
        setTimeout(() => {
            document.getElementById('loadingOverlay').style.display = 'none';
        }, 10000);
    });
</script>
	<script>
    // Atualizar status do loading
    function updateLoadingStatus(message) {
        const statusElement = document.getElementById('loadingStatus');
        if (statusElement) {
            statusElement.textContent = message;
        }
    }
    
    // Monitorar inicialização
    document.addEventListener('DOMContentLoaded', function() {
        updateLoadingStatus('Inicializando Firebase...');
        
        // Monitorar status do Firebase
        const checkFirebase = setInterval(() => {
            if (window.firebaseAppIntegration) {
                if (window.firebaseAppIntegration.initialized) {
                    updateLoadingStatus('Firebase conectado! Carregando dados...');
                    clearInterval(checkFirebase);
                } else {
                    updateLoadingStatus('Firebase offline, usando modo local...');
                }
            }
        }, 500);
    });
</script>
</body>
</html>
