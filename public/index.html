<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Fila de Chamados - Payhub</title>
    
    <!-- CDNs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-headset"></i>
                    Portal de Fila de Chamados - Payhub v3.4.0
                </h1>
                <p>Sistema otimizado com integração Firebase</p>
            </div>
            <div class="user-info" id="userInfo">
                <i class="fas fa-user"></i>
                <span id="userName">Não logado</span>
            </div>
        </div>
        
        <!-- Menu de navegação -->
        <div class="nav-menu">
            <a href="index.html" class="nav-link active">
                <i class="fas fa-home"></i>
                Principal
            </a>
            <a href="analyst-view.html" class="nav-link">
                <i class="fas fa-eye"></i>
                Visualização
            </a>
            <a href="admin.html" class="nav-link">
                <i class="fas fa-cogs"></i>
                Administração
            </a>
        </div>
        
        <!-- Painel de tempo -->
        <div class="time-panel">
            <div class="time-info">
                <i class="fas fa-clock" style="font-size: 24px;"></i>
                <div class="time-text">
                    <div class="time-date" id="currentDate">Carregando data...</div>
                    <div class="time-clock" id="currentTime">Carregando hora...</div>
                </div>
            </div>
            <div id="simulationIndicator" class="simulation-indicator" style="display: none;">
                <i class="fas fa-magic"></i>
                Horário simulado
            </div>
        </div>
        
        <!-- COLUNAS DE STATUS DOS ANALISTAS -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-columns"></i>
                Status dos Analistas
            </div>
            <div id="analystStatusColumns">
                <!-- As colunas serão geradas dinamicamente pelo app.js -->
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>Carregando status dos analistas...</span>
                </div>
            </div>
        </div>
        
        <!-- Clientes Especiais -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-star"></i>
                Clientes Especiais
            </div>
            <div id="specialCases">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>Carregando clientes especiais...</span>
                </div>
            </div>
        </div>
        
        <!-- Estatísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTickets">0</div>
                <div class="stat-label">Chamados Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="availableAnalystsStat">0</div>
                <div class="stat-label">Analistas Disponíveis</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="nextInQueue">-</div>
                <div class="stat-label">Próximo na Fila</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="specialTickets">0</div>
                <div class="stat-label">Casos Especiais</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="waitingTickets">0</div>
                <div class="stat-label">Aguardando Cliente</div>
            </div>
        </div>
        
        <!-- Painel de controles -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-plus-circle"></i>
                Novo Chamado - Clientes Especiais
            </div>
            <div class="control-group">
                <input type="text" id="newTicketNumber" class="input-field" 
                       placeholder="Número do chamado para cliente especial"
                       autocomplete="off" autofocus>
                <select id="ticketType" class="input-field">
                    <option value="TIM">Cliente TIM (Eric)</option>
                    <option value="DPSP">Cliente DPSP (Felipe)</option>
                    <option value="Benoit">Cliente Benoit (André)</option>
                </select>
                <button class="btn btn-success" id="addTicketBtn">
                    <i class="fas fa-plus"></i>
                    Adicionar Chamado Especial
                </button>
            </div>
            <div class="info-box" style="margin: 0 20px 20px 20px;">
                <div style="font-size: 12px; color: #666;">
                    <i class="fas fa-info-circle"></i>
                    <strong>Informação:</strong> Use os inputs nos cards dos analistas disponíveis para atribuição rápida de chamados normais. Para clientes especiais, use este painel.
                </div>
            </div>
        </div>
        
        <!-- Controles da Fila -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-cogs"></i>
                Controles da Fila
            </div>
            <div class="control-group">
                <button class="btn" id="nextAnalystBtn">
                    <i class="fas fa-forward"></i>
                    Avançar Fila
                </button>
                <button class="btn btn-warning" id="resetQueueBtn">
                    <i class="fas fa-redo-alt"></i>
                    Reiniciar Dia
                </button>
                <button class="btn btn-danger" id="freeAllBtn">
                    <i class="fas fa-user-check"></i>
                    Liberar Todos
                </button>
                <button class="btn" id="simulateTimeBtn">
                    <i class="fas fa-magic"></i>
                    Simular Horário
                </button>
                <button class="btn btn-cyan" id="realTimeBtn" style="display: none;">
                    <i class="fas fa-clock"></i>
                    Voltar ao Horário Real
                </button>
                <button class="btn" id="generateReportBtn">
                    <i class="fas fa-file-csv"></i>
                    Gerar Relatório
                </button>
                <!-- Botão de teste Firebase -->
                <button class="btn btn-test" id="testFirebaseBtn" style="background: #6A1B9A; color: white;">
                    <i class="fas fa-vial"></i>
                    Testar Firebase
                </button>
            </div>
        </div>
        
        <!-- Rodapé -->
        <div class="footer">
            <p><strong>Portal de Fila de Chamados - Equipe Payhub v3.4.0</strong> | Sistema com integração Firebase</p>
            <p>Última atualização: <span id="lastUpdate">--:--:--</span></p>
            <p class="last-reset">Fila reiniciada em: <span id="lastResetDate"></span></p>
        </div>
    </div>
    
    <!-- Modal de Simulação de Horário -->
    <div id="timeSimulationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-magic"></i>
                    Simular Horário
                </div>
                <button class="close-modal" id="closeTimeModal">&times;</button>
            </div>
            <div class="modal-description">
                <p>Selecione um horário para simular a disponibilidade dos analistas:</p>
            </div>
            <div class="time-options-grid">
                <button class="time-option" data-hour="8">08:00</button>
                <button class="time-option" data-hour="9">09:00</button>
                <button class="time-option" data-hour="10">10:00</button>
                <button class="time-option" data-hour="11">11:00</button>
                <button class="time-option" data-hour="12">12:00</button>
                <button class="time-option" data-hour="13">13:00</button>
                <button class="time-option" data-hour="14">14:00</button>
                <button class="time-option" data-hour="15">15:00</button>
                <button class="time-option" data-hour="16">16:00</button>
                <button class="time-option" data-hour="17">17:00</button>
                <button class="time-option" data-hour="18">18:00</button>
                <button class="time-option" data-hour="19">19:00</button>
                <button class="time-option" data-hour="20">20:00</button>
                <button class="time-option" data-hour="21">21:00</button>
                <button class="time-option" data-hour="22">22:00</button>
                <button class="time-option" data-hour="23">23:00</button>
            </div>
            <div class="modal-actions">
                <button class="btn" id="cancelSimulation">Cancelar</button>
                <button class="btn btn-success" id="applySimulation">Aplicar Simulação</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Relatórios -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-csv"></i>
                    Gerar Relatório
                </div>
                <button class="close-modal" id="closeReportModal">&times;</button>
            </div>
            <div class="modal-description">
                <p>Selecione o período para gerar o relatório de chamados:</p>
            </div>
            <div class="modal-controls">
                <div class="form-group">
                    <label for="startDate">
                        <i class="far fa-calendar-alt"></i>
                        Data Inicial
                    </label>
                    <input type="date" id="startDate" class="input-field">
                </div>
                <div class="form-group">
                    <label for="endDate">
                        <i class="far fa-calendar-alt"></i>
                        Data Final
                    </label>
                    <input type="date" id="endDate" class="input-field">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="includeAllTickets">
                    <label for="includeAllTickets">Incluir todos os chamados (não apenas os especiais)</label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" id="cancelReport">Cancelar</button>
                <button class="btn btn-success" id="generateCSV">Gerar CSV</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Login (Oculto por padrão) -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-sign-in-alt"></i>
                    Login do Sistema
                </div>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-description">
                <p>Entre com suas credenciais para acessar o sistema de fila:</p>
                <p style="margin-top: 10px; background: #FFF3E0; padding: 10px; border-radius: 6px; font-size: 13px;">
                    <i class="fas fa-lightbulb"></i> 
                    <strong>Para teste use:</strong> qualquer@email.com / dev123
                </p>
            </div>
            <div class="modal-controls">
                <div class="form-group">
                    <label for="loginEmail">
                        <i class="fas fa-envelope"></i>
                        E-mail
                    </label>
                    <input type="email" id="loginEmail" class="input-field" 
                           placeholder="seu.email@dominio.com" value="admin@payhub.com.br">
                </div>
                <div class="form-group">
                    <label for="loginPassword">
                        <i class="fas fa-lock"></i>
                        Senha
                    </label>
                    <input type="password" id="loginPassword" class="input-field" 
                           placeholder="Sua senha" value="dev123">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberMe" checked>
                    <label for="rememberMe">Lembrar-me</label>
                </div>
                <div class="error-box" id="loginError" style="display: none;">
                    <div class="error-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="loginErrorMessage"></span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" id="closeLoginBtn">Cancelar</button>
                <button class="btn btn-success" id="loginBtn">Entrar</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-app.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Inicialização adicional
        document.addEventListener('DOMContentLoaded', function() {
            // Botão de fechar modal de login
            const closeLoginBtn = document.getElementById('closeLoginBtn');
            const closeLoginModalBtn = document.getElementById('closeLoginModal');
            
            if (closeLoginBtn) {
                closeLoginBtn.addEventListener('click', function() {
                    document.getElementById('loginModal').style.display = 'none';
                });
            }
            
            if (closeLoginModalBtn) {
                closeLoginModalBtn.addEventListener('click', function() {
                    document.getElementById('loginModal').style.display = 'none';
                });
            }
            
            // Botão de teste Firebase
            const testFirebaseBtn = document.getElementById('testFirebaseBtn');
            if (testFirebaseBtn) {
                testFirebaseBtn.addEventListener('click', async function() {
                    showNotification('Testando conexão com Firebase...', 'info');
                    
                    const result = await window.testFirebaseIntegration();
                    if (result) {
                        showNotification('✅ Firebase conectado com sucesso!', 'success');
                    } else {
                        showNotification('❌ Erro na conexão com Firebase', 'error');
                    }
                });
            }
            
            // Fechar modais ao clicar fora
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
            
            // Fechar modais com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
        });
    </script>
</body>
</html>
